--========================================================--
--               TELEPORT A <-> B (COMPACT)              --
--========================================================--

local GUI_NAME = "ABTeleporterUI"
if game.CoreGui:FindFirstChild(GUI_NAME) then
    game.CoreGui:FindFirstChild(GUI_NAME):Destroy()
end

local player = game.Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- Frame Utama (lebih kecil)
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = GUI_NAME
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 180, 0, 125)  -- <<< DIPERKECIL
main.Position = UDim2.new(0.5, -90, 0.5, -62)
main.BackgroundColor3 = Color3.fromRGB(20,20,20)
main.BorderSizePixel = 0

-- Drag
local UIS = game:GetService("UserInputService")
local dragging, dragStart, startPos
main.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
    end
end)
UIS.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        main.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end
end)
UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- Title bar (lebih kecil)
local title = Instance.new("Frame", main)
title.Size = UDim2.new(1, 0, 0, 22)
title.BackgroundColor3 = Color3.fromRGB(30,30,30)
title.BorderSizePixel = 0

local titleText = Instance.new("TextLabel", title)
titleText.Size = UDim2.new(1, -40, 1, 0)
titleText.Position = UDim2.new(0,5,0,0)
titleText.BackgroundTransparency = 1
titleText.Text = "TP A <-> B"
titleText.TextColor3 = Color3.fromRGB(255,255,255)
titleText.TextSize = 14
titleText.Font = Enum.Font.SourceSansBold
titleText.TextXAlignment = Enum.TextXAlignment.Left

-- minimize dan close (lebih kecil)
local close = Instance.new("TextButton", title)
close.Size = UDim2.new(0,20,1,0)
close.Position = UDim2.new(1,-20,0,0)
close.BackgroundTransparency = 1
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255,100,100)
close.TextSize = 14
close.Font = Enum.Font.SourceSansBold
close.MouseButton1Click:Connect(function() gui:Destroy() end)

local mini = Instance.new("TextButton", title)
mini.Size = UDim2.new(0,20,1,0)
mini.Position = UDim2.new(1,-40,0,0)
mini.BackgroundTransparency = 1
mini.Text = "_"
mini.TextColor3 = Color3.fromRGB(180,180,180)
mini.TextSize = 16
mini.Font = Enum.Font.SourceSansBold

local minimized = false
mini.MouseButton1Click:Connect(function()
    minimized = not minimized
    TweenService:Create(main, TweenInfo.new(0.25), {
        Size = minimized and UDim2.new(0,180,0,22) or UDim2.new(0,180,0,125)
    }):Play()
end)

-- Input waktu (diperkecil)
local input = Instance.new("TextBox", main)
input.Size = UDim2.new(1, -10, 0, 22)
input.Position = UDim2.new(0, 5, 0, 28)
input.BackgroundColor3 = Color3.fromRGB(40,40,40)
input.TextColor3 = Color3.fromRGB(255,255,255)
input.TextSize = 14
input.Font = Enum.Font.SourceSans
input.PlaceholderText = "Durasi (detik)"
input.Text = ""

-- Tombol start/stop (lebih kecil)
local startBtn = Instance.new("TextButton", main)
startBtn.Size = UDim2.new(1, -10, 0, 22)
startBtn.Position = UDim2.new(0, 5, 0, 55)
startBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
startBtn.TextColor3 = Color3.fromRGB(255,255,255)
startBtn.TextSize = 14
startBtn.Font = Enum.Font.SourceSansBold
startBtn.Text = "Start"

-- Tombol TP mode (lebih kecil)
local tpBtn = Instance.new("TextButton", main)
tpBtn.Size = UDim2.new(1, -10, 0, 22)
tpBtn.Position = UDim2.new(0, 5, 0, 82)
tpBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
tpBtn.TextColor3 = Color3.fromRGB(255,255,255)
tpBtn.TextSize = 14
tpBtn.Font = Enum.Font.SourceSansBold
tpBtn.Text = "TP B (Manual)"

-- Status kecil
local status = Instance.new("TextLabel", main)
status.Size = UDim2.new(1, -10, 0, 16)
status.Position = UDim2.new(0, 5, 0, 106)
status.BackgroundTransparency = 1
status.TextColor3 = Color3.fromRGB(200,200,200)
status.TextSize = 12
status.Font = Enum.Font.SourceSans

-- LOGIC
local savedA, savedB
local isRunning = false
local goingToB = true
local timerThread

local function teleport(pos)
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp then hrp.CFrame = pos end
end

tpBtn.MouseButton1Click:Connect(function()
    if goingToB then
        if not savedB then status.Text = "Belum save B"; return end
        teleport(savedB)
    else
        if not savedA then status.Text = "Belum save A"; return end
        teleport(savedA)
    end
    goingToB = not goingToB
    tpBtn.Text = goingToB and "TP B (Manual)" or "TP A (Manual)"
end)

startBtn.MouseButton1Click:Connect(function()
    if isRunning then
        isRunning = false
        startBtn.Text = "Start"
        status.Text = "Stopped"
        return
    end

    local dur = tonumber(input.Text)
    if not dur or dur <= 0 then status.Text = "Durasi invalid"; return end
    if not savedA or not savedB then status.Text = "Belum save A/B"; return end

    isRunning = true
    startBtn.Text = "Stop"

    timerThread = task.spawn(function()
        while isRunning do
            status.Text = "Next: " .. dur .. "s"
            for i = dur,1,-1 do
                if not isRunning then break end
                status.Text = "Next: "..i.."s"
                task.wait(1)
            end
            if not isRunning then break end

            local target = goingToB and savedB or savedA
            teleport(target)
            goingToB = not goingToB
            tpBtn.Text = goingToB and "TP B (Manual)" or "TP A (Manual)"
        end
    end)
end)

-- Simpan posisi otomatis hanya saat manual pertama kali ditekan
savedA = player.Character.HumanoidRootPart.CFrame
savedB = player.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,10)
status.Text = "Siap"
